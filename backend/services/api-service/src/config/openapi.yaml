# =============================================================================
# YYCÂ³é¤é¥®å¹³å° - APIæœåŠ¡æ–‡æ¡£
# OpenAPI 3.0 è§„èŒƒ
# =============================================================================
# @project YYCÂ³-Catering-Platform
# @module yyc3-catering-api-service
# @version 1.0.0
# @author YYCÂ³ Development Team <dev@yyc3.red>
# @license MIT <https://opensource.org/licenses/MIT>
# =============================================================================

openapi: 3.0.3
info:
  title: YYCÂ³é¤é¥®å¹³å°APIæœåŠ¡
  description: |
    YYCÂ³é¤é¥®å¹³å°æ ¸å¿ƒRESTful APIæœåŠ¡

    ## åŠŸèƒ½ç‰¹æ€§
    - ğŸ” å®Œæ•´çš„èº«ä»½éªŒè¯å’Œæˆæƒç³»ç»Ÿ
    - ğŸ½ï¸ é¤å…å’Œèœå•ç®¡ç†
    - ğŸ“¦ è®¢å•å¤„ç†å’ŒçŠ¶æ€è·Ÿè¸ª
    - ğŸ“Š ç»Ÿè®¡åˆ†æå’ŒæŠ¥å‘Š
    - ğŸ›¡ï¸ ä¼ä¸šçº§å®‰å…¨é˜²æŠ¤
    - ğŸ“ˆ é«˜æ€§èƒ½APIå“åº”

    ## æŠ€æœ¯æ ˆ
    - **è¿è¡Œæ—¶**: Bun 1.1+
    - **è¯­è¨€**: TypeScript
    - **æ•°æ®åº“**: PostgreSQL
    - **ç¼“å­˜**: Redis
    - **è®¤è¯**: JWT
  version: 1.0.0
  contact:
    name: YYCÂ³ Development Team
    email: dev@yyc3.red
    url: https://yyc3.red
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT

servers:
  - url: http://localhost:3006
    description: å¼€å‘ç¯å¢ƒ
  - url: https://api.0379.love
    description: ç”Ÿäº§ç¯å¢ƒ

tags:
  - name: å¥åº·æ£€æŸ¥
    description: ç³»ç»Ÿå¥åº·çŠ¶æ€å’ŒåŸºæœ¬ä¿¡æ¯
  - name: èº«ä»½éªŒè¯
    description: ç”¨æˆ·ç™»å½•ã€æ³¨å†Œã€ä»¤ç‰Œç®¡ç†
  - name: èœå•ç®¡ç†
    description: é¤å…èœå•å’Œèœå“ç®¡ç†
  - name: è®¢å•ç®¡ç†
    description: è®¢å•åˆ›å»ºã€çŠ¶æ€æ›´æ–°ã€é…é€ç®¡ç†

paths:
  /health:
    get:
      tags:
        - å¥åº·æ£€æŸ¥
      summary: ç³»ç»Ÿå¥åº·æ£€æŸ¥
      description: è·å–APIæœåŠ¡åŠå…¶ä¾èµ–ç»„ä»¶çš„å¥åº·çŠ¶æ€
      responses:
        '200':
          description: æœåŠ¡å¥åº·
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthResponse'
              example:
                status: healthy
                timestamp: "2025-01-09T10:00:00.000Z"
                version: "1.0.0"
                environment: development
                uptime: 3600.5
                responseTime: "5ms"

  /api/v1:
    get:
      tags:
        - å¥åº·æ£€æŸ¥
      summary: APIä¿¡æ¯
      description: è·å–APIæœåŠ¡åŸºæœ¬ä¿¡æ¯å’Œå¯ç”¨ç«¯ç‚¹
      responses:
        '200':
          description: APIä¿¡æ¯
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiInfoResponse'

  /api/v1/auth/register:
    post:
      tags:
        - èº«ä»½éªŒè¯
      summary: ç”¨æˆ·æ³¨å†Œ
      description: åˆ›å»ºæ–°ç”¨æˆ·è´¦æˆ·
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RegisterRequest'
      responses:
        '201':
          description: æ³¨å†ŒæˆåŠŸ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
        '400':
          description: è¯·æ±‚å‚æ•°é”™è¯¯
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '409':
          description: é‚®ç®±å·²å­˜åœ¨
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/v1/auth/login:
    post:
      tags:
        - èº«ä»½éªŒè¯
      summary: ç”¨æˆ·ç™»å½•
      description: ç”¨æˆ·èº«ä»½éªŒè¯å¹¶è·å–è®¿é—®ä»¤ç‰Œ
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginRequest'
      responses:
        '200':
          description: ç™»å½•æˆåŠŸ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
        '401':
          description: è®¤è¯å¤±è´¥
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/v1/auth/verify:
    get:
      tags:
        - èº«ä»½éªŒè¯
      summary: éªŒè¯ä»¤ç‰Œ
      description: éªŒè¯JWTä»¤ç‰Œçš„æœ‰æ•ˆæ€§
      security:
        - bearerAuth: []
      responses:
        '200':
          description: ä»¤ç‰Œæœ‰æ•ˆ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/VerifyTokenResponse'
        '401':
          description: ä»¤ç‰Œæ— æ•ˆæˆ–å·²è¿‡æœŸ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/v1/auth/refresh-token:
    post:
      tags:
        - èº«ä»½éªŒè¯
      summary: åˆ·æ–°ä»¤ç‰Œ
      description: ä½¿ç”¨åˆ·æ–°ä»¤ç‰Œè·å–æ–°çš„è®¿é—®ä»¤ç‰Œ
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RefreshTokenRequest'
      responses:
        '200':
          description: ä»¤ç‰Œåˆ·æ–°æˆåŠŸ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RefreshTokenResponse'
        '401':
          description: åˆ·æ–°ä»¤ç‰Œæ— æ•ˆ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/v1/auth/logout:
    post:
      tags:
        - èº«ä»½éªŒè¯
      summary: ç”¨æˆ·ç™»å‡º
      description: ç”¨æˆ·ç™»å‡ºï¼ˆåœ¨å®é™…é¡¹ç›®ä¸­ä¼šå°†ä»¤ç‰ŒåŠ å…¥é»‘åå•ï¼‰
      security:
        - bearerAuth: []
      responses:
        '200':
          description: ç™»å‡ºæˆåŠŸ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'

  /api/v1/menu/items:
    get:
      tags:
        - èœå•ç®¡ç†
      summary: è·å–èœå•åˆ—è¡¨
      description: è·å–é¤å…èœå•é¡¹ç›®åˆ—è¡¨ï¼Œæ”¯æŒåˆ†é¡µå’Œç­›é€‰
      security:
        - bearerAuth: []
      parameters:
        - name: page
          in: query
          description: é¡µç 
          required: false
          schema:
            type: integer
            default: 1
        - name: limit
          in: query
          description: æ¯é¡µæ•°é‡
          required: false
          schema:
            type: integer
            default: 20
        - name: category
          in: query
          description: èœå“åˆ†ç±»
          required: false
          schema:
            type: string
        - name: search
          in: query
          description: æœç´¢å…³é”®è¯
          required: false
          schema:
            type: string
      responses:
        '200':
          description: èœå•åˆ—è¡¨
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MenuItemsResponse'

    post:
      tags:
        - èœå•ç®¡ç†
      summary: åˆ›å»ºèœå•é¡¹
      description: æ·»åŠ æ–°çš„èœå•é¡¹ç›®
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateMenuItemRequest'
      responses:
        '201':
          description: åˆ›å»ºæˆåŠŸ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MenuItemResponse'

  /api/v1/menu/items/{id}:
    get:
      tags:
        - èœå•ç®¡ç†
      summary: è·å–èœå•é¡¹è¯¦æƒ…
      description: æ ¹æ®IDè·å–ç‰¹å®šèœå•é¡¹çš„è¯¦ç»†ä¿¡æ¯
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: èœå•é¡¹ID
          schema:
            type: integer
      responses:
        '200':
          description: èœå•é¡¹è¯¦æƒ…
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MenuItemResponse'
        '404':
          description: èœå•é¡¹ä¸å­˜åœ¨
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    put:
      tags:
        - èœå•ç®¡ç†
      summary: æ›´æ–°èœå•é¡¹
      description: æ›´æ–°æŒ‡å®šèœå•é¡¹çš„ä¿¡æ¯
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: èœå•é¡¹ID
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateMenuItemRequest'
      responses:
        '200':
          description: æ›´æ–°æˆåŠŸ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MenuItemResponse'
        '404':
          description: èœå•é¡¹ä¸å­˜åœ¨
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    delete:
      tags:
        - èœå•ç®¡ç†
      summary: åˆ é™¤èœå•é¡¹
      description: åˆ é™¤æŒ‡å®šçš„èœå•é¡¹
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: èœå•é¡¹ID
          schema:
            type: integer
      responses:
        '200':
          description: åˆ é™¤æˆåŠŸ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '404':
          description: èœå•é¡¹ä¸å­˜åœ¨
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/v1/orders:
    get:
      tags:
        - è®¢å•ç®¡ç†
      summary: è·å–è®¢å•åˆ—è¡¨
      description: è·å–è®¢å•åˆ—è¡¨ï¼Œæ”¯æŒåˆ†é¡µå’ŒçŠ¶æ€ç­›é€‰
      security:
        - bearerAuth: []
      parameters:
        - name: page
          in: query
          description: é¡µç 
          required: false
          schema:
            type: integer
            default: 1
        - name: limit
          in: query
          description: æ¯é¡µæ•°é‡
          required: false
          schema:
            type: integer
            default: 20
        - name: status
          in: query
          description: è®¢å•çŠ¶æ€
          required: false
          schema:
            type: string
            enum: [pending, confirmed, preparing, ready, completed, cancelled]
      responses:
        '200':
          description: è®¢å•åˆ—è¡¨
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OrdersResponse'

    post:
      tags:
        - è®¢å•ç®¡ç†
      summary: åˆ›å»ºè®¢å•
      description: åˆ›å»ºæ–°çš„è®¢å•
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateOrderRequest'
      responses:
        '201':
          description: åˆ›å»ºæˆåŠŸ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OrderResponse'

  /api/v1/orders/{id}:
    get:
      tags:
        - è®¢å•ç®¡ç†
      summary: è·å–è®¢å•è¯¦æƒ…
      description: æ ¹æ®IDè·å–è®¢å•è¯¦ç»†ä¿¡æ¯
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: è®¢å•ID
          schema:
            type: integer
      responses:
        '200':
          description: è®¢å•è¯¦æƒ…
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OrderResponse'
        '404':
          description: è®¢å•ä¸å­˜åœ¨
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:
    HealthResponse:
      type: object
      properties:
        status:
          type: string
          enum: [healthy, unhealthy]
        timestamp:
          type: string
          format: date-time
        version:
          type: string
        environment:
          type: string
        uptime:
          type: number
        responseTime:
          type: string
        services:
          type: object
          properties:
            database:
              $ref: '#/components/schemas/ServiceHealth'
        memory:
          type: object
          properties:
            used:
              type: integer
            total:
              type: integer
            external:
              type: integer

    ServiceHealth:
      type: object
      properties:
        status:
          type: string
          enum: [healthy, unhealthy]
        responseTime:
          type: string

    ApiInfoResponse:
      type: object
      properties:
        name:
          type: string
        version:
          type: string
        description:
          type: string
        environment:
          type: string
        timestamp:
          type: string
          format: date-time
        endpoints:
          type: object
          properties:
            auth:
              type: string
            menu:
              type: string
            orders:
              type: string
            health:
              type: string

    ErrorResponse:
      type: object
      properties:
        success:
          type: boolean
          example: false
        error:
          type: string
        code:
          type: string
        errors:
          type: array
          items:
            type: string
        timestamp:
          type: string
          format: date-time

    SuccessResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        message:
          type: string
        timestamp:
          type: string
          format: date-time

    RegisterRequest:
      type: object
      required:
        - email
        - password
        - name
      properties:
        email:
          type: string
          format: email
          example: user@example.com
        password:
          type: string
          minLength: 8
          example: password123
        name:
          type: string
          minLength: 2
          maxLength: 100
          example: å¼ ä¸‰

    LoginRequest:
      type: object
      required:
        - email
        - password
      properties:
        email:
          type: string
          format: email
          example: user@example.com
        password:
          type: string
          example: password123

    AuthResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        data:
          type: object
          properties:
            user:
              $ref: '#/components/schemas/User'
            token:
              type: string
            refreshToken:
              type: string
            expiresIn:
              type: string
        message:
          type: string
        timestamp:
          type: string
          format: date-time

    VerifyTokenResponse:
      type: object
      properties:
        success:
          type: boolean
        data:
          type: object
          properties:
            user:
              $ref: '#/components/schemas/User'
        error:
          type: string
        code:
          type: string
        timestamp:
          type: string
          format: date-time

    RefreshTokenRequest:
      type: object
      required:
        - refreshToken
      properties:
        refreshToken:
          type: string

    RefreshTokenResponse:
      type: object
      properties:
        success:
          type: boolean
        data:
          type: object
          properties:
            token:
              type: string
            refreshToken:
              type: string
            expiresIn:
              type: string
        timestamp:
          type: string
          format: date-time

    User:
      type: object
      properties:
        id:
          type: integer
        email:
          type: string
          format: email
        name:
          type: string
        role:
          type: string
          enum: [admin, restaurant_admin, customer]
        createdAt:
          type: string
          format: date-time
        lastLoginAt:
          type: string
          format: date-time

    MenuItemsResponse:
      type: object
      properties:
        success:
          type: boolean
        data:
          type: object
          properties:
            items:
              type: array
              items:
                $ref: '#/components/schemas/MenuItem'
            pagination:
              $ref: '#/components/schemas/Pagination'
        timestamp:
          type: string
          format: date-time

    MenuItem:
      type: object
      properties:
        id:
          type: integer
        name:
          type: string
        description:
          type: string
        price:
          type: number
        category:
          type: string
        imageUrl:
          type: string
        available:
          type: boolean
        preparationTime:
          type: integer
        nutritionalInfo:
          type: object
        ingredients:
          type: array
          items:
            type: string

    CreateMenuItemRequest:
      type: object
      required:
        - name
        - price
        - category
      properties:
        name:
          type: string
        description:
          type: string
        price:
          type: number
        category:
          type: string
        imageUrl:
          type: string
        available:
          type: boolean
        preparationTime:
          type: integer
        nutritionalInfo:
          type: object
        ingredients:
          type: array
          items:
            type: string

    UpdateMenuItemRequest:
      type: object
      properties:
        name:
          type: string
        description:
          type: string
        price:
          type: number
        category:
          type: string
        imageUrl:
          type: string
        available:
          type: boolean
        preparationTime:
          type: integer
        nutritionalInfo:
          type: object
        ingredients:
          type: array
          items:
            type: string

    MenuItemResponse:
      type: object
      properties:
        success:
          type: boolean
        data:
          $ref: '#/components/schemas/MenuItem'
        timestamp:
          type: string
          format: date-time

    OrdersResponse:
      type: object
      properties:
        success:
          type: boolean
        data:
          type: object
          properties:
            orders:
              type: array
              items:
                $ref: '#/components/schemas/Order'
            pagination:
              $ref: '#/components/schemas/Pagination'
        timestamp:
          type: string
          format: date-time

    Order:
      type: object
      properties:
        id:
          type: integer
        orderNumber:
          type: string
        userId:
          type: integer
        restaurantId:
          type: integer
        items:
          type: array
          items:
            $ref: '#/components/schemas/OrderItem'
        totalAmount:
          type: number
        status:
          type: string
          enum: [pending, confirmed, preparing, ready, completed, cancelled]
        deliveryAddress:
          type: string
        contactPhone:
          type: string
        specialInstructions:
          type: string
        createdAt:
          type: string
          format: date-time
        estimatedDeliveryTime:
          type: string
          format: date-time
        actualDeliveryTime:
          type: string
          format: date-time

    OrderItem:
      type: object
      properties:
        menuItemId:
          type: integer
        quantity:
          type: integer
        price:
          type: number
        customizations:
          type: object

    CreateOrderRequest:
      type: object
      required:
        - items
        - deliveryAddress
        - contactPhone
      properties:
        items:
          type: array
          items:
            type: object
            properties:
              menuItemId:
                type: integer
              quantity:
                type: integer
              customizations:
                type: object
        deliveryAddress:
          type: string
        contactPhone:
          type: string
        specialInstructions:
          type: string

    OrderResponse:
      type: object
      properties:
        success:
          type: boolean
        data:
          $ref: '#/components/schemas/Order'
        timestamp:
          type: string
          format: date-time

    Pagination:
      type: object
      properties:
        page:
          type: integer
        limit:
          type: integer
        total:
          type: integer
        totalPages:
          type: integer