---
@file: ingress-controller-eks.yaml
@description: AWS EKS NGINX Ingress Controlleré…ç½®
@platform: AWS EKS
@version: v1.28
@ingress-controller: NGINX
---

# NGINX Ingress Controller Configuration for AWS EKS

---

## ğŸ“‹ Description

æœ¬æ–‡ä»¶å®šä¹‰äº†YYCÂ³é¤é¥®å¹³å°åœ¨AWS EKSé›†ç¾¤ä¸Šçš„NGINX Ingress Controlleré…ç½®ã€‚

NGINX Ingress Controlleræ˜¯ä¸€ä¸ªKubernetes Ingress Controllerï¼Œç”¨äºå°†å¤–éƒ¨æµé‡è·¯ç”±åˆ°Kubernetesé›†ç¾¤å†…éƒ¨çš„æœåŠ¡ã€‚

---

## ğŸ“ NGINX Ingress Controller Features

### 1. è·¯ç”±åŠŸèƒ½

- **åŸºäºè·¯å¾„çš„è·¯ç”±**
- **åŸºäºä¸»æœºåçš„è·¯ç”±**
- **TLSç»ˆæ­¢ï¼ˆHTTPSï¼‰**
- **URLé‡å†™**

### 2. è´Ÿè½½å‡è¡¡åŠŸèƒ½

- **è½®è¯¢ï¼ˆRound Robinï¼‰**
- **æœ€å°‘è¿æ¥ï¼ˆLeast Connectionsï¼‰**
- **ä¼šè¯ä¿æŒï¼ˆSession Affinityï¼‰**

### 3. å¯è§‚æµ‹æ€§åŠŸèƒ½

- **Prometheusé›†æˆ**
- **Grafana Dashboard**
- **è®¿é—®æ—¥å¿—**
- **é”™è¯¯æ—¥å¿—**

---

## ğŸš€ Kubernetes Manifests

```yaml
# ingress-controller-eks.yaml
apiVersion: v1
kind: Namespace
metadata:
  name: ingress-nginx
  labels:
    app.kubernetes.io/name: ingress-nginx
    app.kubernetes.io/instance: ingress-nginx
---
apiVersion: helm.cattle.io/v1
kind: HelmChart
metadata:
  name: ingress-nginx
  namespace: ingress-nginx
spec:
  chart: ingress-nginx
  repo: https://kubernetes.github.io/ingress-nginx
  version: 4.9.0
  targetNamespace: ingress-nginx
  set:
    - name: controller.replicaCount
      value: 2
    - name: controller.service.annotations.service\.beta\.kubernetes\.io/aws-load-balancer-type
      value: "nlb"
    - name: controller.service.annotations.service\.beta\.kubernetes\.io/aws-load-balancer-cross-zone-load-balancing-enabled
      value: "true"
    - name: controller.service.annotations.service\.beta\.kubernetes\.io/aws-load-balancer-scheme
      value: "internet-facing"
    - name: controller.service.annotations.service\.beta\.kubernetes\.io/aws-load-balancer-healthcheck-healthy-threshold
      value: "2"
    - name: controller.service.annotations.service\.beta\.kubernetes\.io/aws-load-balancer-healthcheck-unhealthy-threshold
      value: "2"
    - name: controller.service.annotations.service\.beta\.kubernetes\.io/aws-load-balancer-healthcheck-interval
      value: "10"
    - name: controller.service.annotations.service\.beta\.kubernetes\.io/aws-load-balancer-healthcheck-timeout
      value: "5"
    - name: controller.service.annotations.service\.beta\.kubernetes\.io/aws-load-balancer-healthcheck-path
      value: "/healthz"
    - name: controller.service.annotations.service\.beta\.kubernetes\.io/aws-load-balancer-healthcheck-protocol
      value: "HTTP"
    - name: controller.service.annotations.service\.beta\.kubernetes\.io/aws-load-balancer-healthcheck-port
      value: "10254"
    - name: controller.service.annotations.service\.beta\.kubernetes\.io/aws-load-balancer-ssl-ports
      value: "443"
    - name: controller.service.annotations.service\.beta\.kubernetes\.io/aws-load-balancer-backend-protocol
      value: "http"
    - name: controller.configMap
      value: "false"
    - name: controller.admissionWebhooks.enabled
      value: "false"
    - name: controller.metrics.enabled
      value: "true"
    - name: controller.metrics.serviceMonitor.enabled
      value: "true"
    - name: controller.metrics.serviceMonitor.namespaceSelector
      value: "monitoring"
    - name: controller.metrics.serviceMonitor.additionalLabels
      value: "app=ingress-nginx"
    - name: controller.publishService.enabled
      value: "true"
    - name: controller.publishService.pathOverride
      value: "/api/v1/namespaces/ingress-nginx/services/ingress-nginx-controller"
    - name: controller.kubernetesResources.configMaps
      value: "true"
    - name: controller.kubernetesResources.ingressClass
      value: "nginx"
    - name: controller.ingressClassResource.name
      value: "nginx"
    - name: controller.ingressClassResource.enabled
      value: "true"
    - name: controller.ingressClassResource.default
      value: "true"
    - name: controller.ingressClassResource.controllerValue
      value: "k8s.io/ingress-nginx"
    - name: controller.ingressClass.parameters
      value: "\"ingressclass.kubernetes.io/is-default-class\"=\"true\""
    - name: controller.ingressClassByDefault
      value: "true"
    - name: controller.ingressClassByName
      value: "true"
```

---

## ğŸ› ï¸ å¿«é€Ÿå¼€å§‹

### 1. ä½¿ç”¨Helmå®‰è£…NGINX Ingress Controller

```bash
# æ·»åŠ NGINX Ingress Controller Helmä»“åº“
helm repo add ingress-nginx https://kubernetes.github.io/ingress-nginx
helm repo update

# å®‰è£…NGINX Ingress Controller
helm install ingress-nginx ingress-nginx/ingress-nginx \
  --namespace ingress-nginx \
  --set controller.replicaCount=2 \
  --set controller.service.annotations.service\.beta\.kubernetes\.io/aws-load-balancer-type="nlb" \
  --set controller.service.annotations.service\.beta\.kubernetes\.io/aws-load-balancer-cross-zone-load-balancing-enabled="true" \
  --set controller.service.annotations.service\.beta\.kubernetes\.io/aws-load-balancer-scheme="internet-facing" \
  --set controller.service.annotations.service\.beta\.kubernetes\.io/aws-load-balancer-healthcheck-healthy-threshold="2" \
  --set controller.service.annotations.service\.beta\.kubernetes\.io/aws-load-balancer-healthcheck-unhealthy-threshold="2" \
  --set controller.service.annotations.service\.beta\.kubernetes\.io/aws-load-balancer-healthcheck-interval="10" \
  --set controller.service.annotations.service\.beta\.kubernetes\.io/aws-load-balancer-healthcheck-timeout="5" \
  --set controller.service.annotations.service\.beta\.kubernetes\.io/aws-load-balancer-healthcheck-path="/healthz" \
  --set controller.service.annotations.service\.beta\.kubernetes\.io/aws-load-balancer-healthcheck-protocol="HTTP" \
  --set controller.service.annotations.service\.beta\.kubernetes\.io/aws-load-balancer-healthcheck-port="10254" \
  --set controller.service.annotations.service\.beta\.kubernetes\.io/aws-load-balancer-ssl-ports="443" \
  --set controller.service.annotations.service\.beta\.kubernetes\.io/aws-load-balancer-backend-protocol="http" \
  --set controller.configMap="false" \
  --set controller.admissionWebhooks.enabled="false" \
  --set controller.metrics.enabled="true" \
  --set controller.metrics.serviceMonitor.enabled="true" \
  --set controller.metrics.serviceMonitor.namespaceSelector="monitoring" \
  --set controller.metrics.serviceMonitor.additionalLabels="app=ingress-nginx" \
  --set controller.publishService.enabled="true" \
  --set controller.publishService.pathOverride="/api/v1/namespaces/ingress-nginx/services/ingress-nginx-controller" \
  --set controller.kubernetesResources.configMaps="true" \
  --set controller.kubernetesResources.ingressClass="nginx" \
  --set controller.ingressClassResource.name="nginx" \
  --set controller.ingressClassResource.enabled="true" \
  --set controller.ingressClassResource.default="true" \
  --set controller.ingressClassResource.controllerValue="k8s.io/ingress-nginx" \
  --set controller.ingressClass.parameters="\"ingressclass.kubernetes.io/is-default-class\"=\"true\"" \
  --set controller.ingressClassByDefault="true" \
  --set controller.ingressClassByName="true"
```

---

### 2. éªŒè¯NGINX Ingress Controllerå®‰è£…

```bash
# æŸ¥çœ‹NGINX Ingress Controller Pod
kubectl get pods -n ingress-nginx -l app.kubernetes.io/name=ingress-nginx

# æŸ¥çœ‹NGINX Ingress Controller Service
kubectl get svc -n ingress-nginx ingress-nginx-controller

# æŸ¥çœ‹NLB (Network Load Balancer)
kubectl get svc -n ingress-nginx ingress-nginx-controller -o json | jq '.status.loadBalancer.ingress'
```

---

### 3. è·å–NLB (Network Load Balancer) DNSåç§°

```bash
# è·å–NLB DNSåç§°
kubectl get svc -n ingress-nginx ingress-nginx-controller -o jsonpath='{.status.loadBalancer.ingress[0].hostname}'
```

**é¢„æœŸè¾“å‡º**ï¼š
```
yyc3-ingress-1234567890.elb.us-east-1.amazonaws.com
```

---

### 4. åˆ›å»ºIngressèµ„æºç¤ºä¾‹

**æ­¥éª¤**ï¼š
1. åˆ›å»ºIngressèµ„æºï¼š
   ```yaml
   apiVersion: networking.k8s.io/v1
   kind: Ingress
   metadata:
     name: yyc3-api-ingress
     namespace: production
     annotations:
       kubernetes.io/ingress.class: nginx
       cert-manager.io/cluster-issuer: letsencrypt-prod
   spec:
     tls:
     - hosts:
       - api.yyc3.com
       secretName: yyc3-api-tls
     rules:
     - host: api.yyc3.com
       http:
         paths:
         - path: /
           pathType: Prefix
           backend:
             service:
               name: api-gateway
               port:
                 number: 8080
   ```

2. åº”ç”¨Ingressèµ„æºï¼š
   ```bash
   kubectl apply -f ingress.yaml
   ```

3. éªŒè¯Ingressèµ„æºï¼š
   ```bash
   kubectl get ingress yyc3-api-ingress -n production
   ```

---

## ğŸ“Š è¾“å‡ºä¸äº¤ä»˜ç‰©

| äº¤ä»˜ç‰© | å†…å®¹ |
|-------|------|
| Kubernetes Manifest | `ingress-controller-eks.yaml` |
| Helm Chart | `ingress-nginx/ingress-nginx` (v4.9.0) |
| NLB (Network Load Balancer) | `yyc3-ingress-1234567890.elb.us-east-1.amazonaws.com` |

---

## ğŸ” å¸¸è§é—®é¢˜

### Q1: NGINX Ingress Controller Podä¸€ç›´å¤„äº `Pending` çŠ¶æ€æ€ä¹ˆåŠï¼Ÿ

**A**:
1. æ£€æŸ¥Podäº‹ä»¶ï¼š
   ```bash
   kubectl describe pod -n ingress-nginx -l app.kubernetes.io/name=ingress-nginx
   ```
2. æ£€æŸ¥NodeçŠ¶æ€ï¼š
   ```bash
   kubectl get nodes
   ```
3. æ£€æŸ¥NLBçŠ¶æ€ï¼š
   ```bash
   kubectl get svc -n ingress-nginx ingress-nginx-controller
   ```

---

### Q2: å¦‚ä½•é…ç½®TLSç»ˆæ­¢ï¼Ÿ

**A**:
1. å®‰è£…Cert Managerï¼ˆè¯¦è§ `cert-manager-eks.yaml`ï¼‰
2. åˆ›å»ºIngressèµ„æºï¼ŒæŒ‡å®š `cert-manager.io/cluster-issuer` å’Œ `tls` å­—æ®µï¼š
   ```yaml
   apiVersion: networking.k8s.io/v1
   kind: Ingress
   metadata:
     name: yyc3-api-ingress
     namespace: production
     annotations:
       kubernetes.io/ingress.class: nginx
       cert-manager.io/cluster-issuer: letsencrypt-prod
   spec:
     tls:
     - hosts:
       - api.yyc3.com
       secretName: yyc3-api-tls
     rules:
     - host: api.yyc3.com
       http:
         paths:
         - path: /
           pathType: Prefix
           backend:
             service:
               name: api-gateway
               port:
                 number: 8080
   ```

---

### Q3: å¦‚ä½•é…ç½®Grafana Dashboardï¼Ÿ

**A**:
1. é…ç½®Prometheus Service Monitorï¼š
   ```yaml
   apiVersion: monitoring.coreos.com/v1
   kind: ServiceMonitor
   metadata:
     name: ingress-nginx
     namespace: monitoring
     labels:
       app: ingress-nginx
   spec:
     namespaceSelector:
       matchNames:
       - ingress-nginx
     selector:
       matchLabels:
         app.kubernetes.io/name: ingress-nginx
     endpoints:
     - port: metrics
   ```

2. åº”ç”¨Service Monitorï¼š
   ```bash
   kubectl apply -f servicemonitor.yaml
   ```

3. åœ¨Grafanaä¸­å¯¼å…¥NGINX Ingress Controller Dashboardï¼ˆIDï¼š9614ï¼‰

---

## ğŸ“š å‚è€ƒæ–‡æ¡£

- [NGINX Ingress Controllerå®˜æ–¹æ–‡æ¡£](https://kubernetes.github.io/ingress-nginx/)
- [AWS NLBæ–‡æ¡£](https://docs.aws.amazon.com/elasticloadbalancing/latest/network/)
- [Helm Chartæ–‡æ¡£](https://artifacthub.io/packages/helm/ingress-nginx/ingress-nginx)

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0.0
**æœ€åæ›´æ–°**: 2026-01-04
**ç»´æŠ¤äºº**: YYCÂ³ Infrastructure Team
