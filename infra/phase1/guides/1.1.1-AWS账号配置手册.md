# AWS账号配置手册

**任务ID**: 1.1.1
**负责人**: 基础设施团队
**预计耗时**: 3小时
**截止日期**: 2026-01-03

---

## 一、准备工作

### 1.1 前置条件

- 拥有AWS企业账号（或个人账号）
- 拥有Root账户访问权限
- 已安装AWS CLI（可选）
- 已配置手机或认证器（MFA）

### 1.2 需要的信息

| 信息项 | 示例值 | 说明 |
|-------|-------|------|
| AWS账号ID | `123456789012` | 12位数字 |
| 账号别名 | `yyc3-production` | 域名前缀 |
| 区域 | `us-east-1` | 主要部署区域 |

---

## 二、配置步骤

### 2.1 创建企业账号（如不存在）

**步骤**：
1. 访问 [AWS控制台](https://console.aws.amazon.com)
2. 使用Root账户登录（邮箱+密码）
3. 登录后，检查右上角显示的账号ID

**检查清单**：
- [ ] AWS账号已创建
- [ ] 可以成功登录

---

### 2.2 配置账号别名

**步骤**：
1. 在控制台右上角，点击账号名称/ID
2. 点击 "My Account"
3. 在左侧导航栏，找到 "Account settings"
4. 找到 "Account alias" 部分
5. 点击 "Create account alias"
6. 输入账号别名：`yyc3-production`
7. 点击 "Save"

**检查清单**：
- [ ] 账号别名已配置
- [ ] 控制台URL显示为：`https://yyc3-production.signin.aws.amazon.com/console`

---

### 2.3 启用Root账户MFA（多因素认证）

**步骤**：
1. 在控制台右上角，点击账号名称
2. 点击 "My Security Credentials"
3. 在 "Activate MFA on your root account" 部分，点击 "Activate MFA"
4. 选择MFA类型：推荐选择 "Authenticator app"
5. 打开MFA应用（Google Authenticator、Microsoft Authenticator等）
6. 扫描二维码或手动输入密钥
7. 输入MFA应用生成的两个连续代码
8. 点击 "Assign MFA"

**检查清单**：
- [ ] Root账户MFA已启用
- [ ] 下次登录需要输入MFA代码

---

### 2.4 创建IAM管理员账户

**步骤**：
1. 在控制台右上角，点击账号名称
2. 点击 "IAM Dashboard"
3. 在 "IAM users" 部分，点击 "Create users"
4. 输入用户名：`yyc3-admin`
5. 选择权限类型："Attach policies directly"
6. 搜索并添加策略：`AdministratorAccess`
7. 点击 "Next"
8. 查看权限，确认无误后点击 "Create user"
9. 复制并保存 "Access key ID" 和 "Secret access key"
10. 点击 "Close"

**重要提示**：
- Access Key仅在创建时显示一次，请妥善保存
- 建议将Access Key保存到密码管理工具（如1Password、AWS Secrets Manager）

**检查清单**：
- [ ] IAM管理员账户已创建
- [ ] 已保存Access Key ID和Secret Access Key

---

### 2.5 配置AWS CLI（可选）

**步骤**：
1. 安装AWS CLI：
   ```bash
   # macOS
   brew install awscli

   # Linux
   curl "https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip" -o "awscliv2.zip"
   unzip awscliv2.zip
   sudo ./aws/install
   ```

2. 配置AWS CLI：
   ```bash
   aws configure
   ```

3. 输入以下信息：
   - AWS Access Key ID: （从IAM管理员账户复制）
   - AWS Secret Access Key: （从IAM管理员账户复制）
   - Default region name: `us-east-1`
   - Default output format: `json`

4. 验证配置：
   ```bash
   aws sts get-caller-identity
   ```

**检查清单**：
- [ ] AWS CLI已安装
- [ ] AWS CLI已配置
- [ ] 验证命令返回正确的账号ID

---

### 2.6 创建自定义IAM策略（可选）

**目的**：为项目创建专用的管理策略，而不是直接使用`AdministratorAccess`。

**步骤**：
1. 在IAM控制台，点击 "Policies"
2. 点击 "Create policy"
3. 选择 "JSON" 标签
4. 输入以下策略内容：
   ```json
   {
     "Version": "2012-10-17",
     "Statement": [
       {
         "Effect": "Allow",
         "Action": "*",
         "Resource": "*"
       }
     ]
   }
   ```
5. 点击 "Next: Tags"
6. 点击 "Next: Review"
7. 输入策略名称：`yyc3-full-access`
8. 输入描述：`YYC³餐饮平台 - 全局访问权限`
9. 点击 "Create policy"

**检查清单**：
- [ ] 自定义IAM策略已创建
- [ ] 策略名称：`yyc3-full-access`

---

### 2.7 创建IAM用户组

**目的**：创建用户组，将多个用户分配到同一权限组。

**步骤**：
1. 在IAM控制台，点击 "User groups"
2. 点击 "Create group"
3. 输入用户组名称：`yyc3-admins`
4. 点击 "Create group"
5. 在用户组列表中，点击 `yyc3-admins`
6. 点击 "Add users to group" 或 "Attach policies"
7. 将策略 `yyc3-full-access`（或`AdministratorAccess`）附加到用户组
8. 点击 "Add permissions"

**检查清单**：
- [ ] IAM用户组已创建
- [ ] 策略已附加到用户组

---

### 2.8 将IAM管理员账户添加到用户组

**步骤**：
1. 在IAM控制台，点击 "Users"
2. 找到用户 `yyc3-admin`，点击用户名
3. 点击 "Add user to groups"
4. 勾选用户组 `yyc3-admins`
5. 点击 "Add user to group"

**检查清单**：
- [ ] IAM管理员账户已添加到用户组

---

## 三、验证与测试

### 3.1 验证账号配置

**命令**：
```bash
aws sts get-caller-identity
```

**预期输出**：
```json
{
  "UserId": "AIDAXXXXXXXXXXXXXXXXX",
  "Account": "123456789012",
  "Arn": "arn:aws:iam::123456789012:user/yyc3-admin"
}
```

### 3.2 验证IAM权限

**命令**：
```bash
aws iam list-policies
```

**预期输出**：
- 返回策略列表，包括 `yyc3-full-access`

### 3.3 验证用户组

**命令**：
```bash
aws iam list-groups-for-user --user-name yyc3-admin
```

**预期输出**：
```json
{
  "Groups": [
    {
      "GroupId": "AGPAXXXXXXXXXXXXXXXX",
      "GroupName": "yyc3-admins",
      "Arn": "arn:aws:iam::123456789012:group/yyc3-admins",
      "CreateDate": "2026-01-03T00:00:00Z"
    }
  ]
}
```

---

## 四、常见问题

### Q1: 忘记了Root账户密码怎么办？

**A**：
1. 访问 https://signin.aws.amazon.com/forgotpassword
2. 输入账号邮箱
3. 点击 "Continue"
4. 按照提示重置密码

---

### Q2: Access Key丢失了怎么办？

**A**：
1. 以管理员身份登录IAM控制台
2. 找到对应用户
3. 点击 "Security credentials"
4. 在 "Access keys" 部分，点击 "Create access key"
5. 创建新的Access Key
6. 删除旧的Access Key（如有必要）

---

### Q3: 如何限制管理员权限？

**A**：
1. 创建自定义策略，只授予必要的权限
2. 使用最小权限原则（Least Privilege）
3. 定期审计IAM权限

---

## 五、输出与交付物

| 交付物 | 内容 |
|-------|------|
| AWS账号ID | `123456789012` |
| 账号别名 | `yyc3-production` |
| IAM管理员账户 | `yyc3-admin` |
| IAM Access Key ID | `AKIA...`（保存到密码管理工具） |
| IAM Secret Access Key | `...`（保存到密码管理工具） |
| IAM用户组 | `yyc3-admins` |
| IAM策略 | `yyc3-full-access` |

---

## 六、参考文档

- [AWS IAM文档](https://docs.aws.amazon.com/iam/)
- [AWS CLI文档](https://docs.aws.amazon.com/cli/)
- [AWS Root账户最佳实践](https://docs.aws.amazon.com/IAM/latest/UserGuide/best-practices.html#lock-away-aws-account-root-user-access-keys)

---

**文档版本**: v1.0.0
**最后更新**: 2026-01-03
**维护人**: YYC³ Infrastructure Team
