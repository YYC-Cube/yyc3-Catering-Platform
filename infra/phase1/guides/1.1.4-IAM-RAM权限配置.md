# IAM/RAM权限配置手册

**任务ID**: 1.1.4
**负责人**: 基础设施团队
**预计耗时**: 4小时
**截止日期**: 2026-01-04

---

## 一、任务概述

本任务的目标是在AWS、阿里云、腾讯云上创建自定义IAM策略（`yyc3-full-access`）、创建用户组（`yyc3-admins`），并将管理员账户添加到用户组，从而实现权限的统一管理。

### 前置条件

- 已完成任务 1.1.1（AWS账号配置）
- 已完成任务 1.1.2（阿里云账号配置）
- 已完成任务 1.1.3（腾讯云账号配置）
- 已创建IAM管理员账户（`yyc3-admin`）

---

## 二、AWS IAM权限配置

### 2.1 创建自定义策略

**步骤**：
1. 登录 [AWS IAM控制台](https://console.aws.amazon.com/iam/)
2. 在左侧导航栏，点击 "Policies"
3. 点击 "Create policy"
4. 选择 "JSON" 标签
5. 输入以下策略内容：
   ```json
   {
     "Version": "2012-10-17",
     "Statement": [
       {
         "Effect": "Allow",
         "Action": "*",
         "Resource": "*"
       }
     ]
   }
   ```
6. 点击 "Next: Tags"
7. 点击 "Next: Review"
8. 输入策略名称：`yyc3-full-access`
9. 输入描述：`YYC³餐饮平台 - 全局访问权限`
10. 点击 "Create policy"

**检查清单**：
- [ ] 自定义IAM策略已创建
- [ ] 策略名称：`yyc3-full-access`

---

### 2.2 创建用户组

**步骤**：
1. 在IAM控制台，点击 "User groups"
2. 点击 "Create group"
3. 输入用户组名称：`yyc3-admins`
4. 点击 "Next" (Attach permissions)
5. 搜索策略 `yyc3-full-access`
6. 勾选该策略
7. 点击 "Next" (Review)
8. 点击 "Create group"

**检查清单**：
- [ ] IAM用户组已创建
- [ ] 策略已附加到用户组

---

### 2.3 将IAM管理员账户添加到用户组

**步骤**：
1. 在IAM控制台，点击 "Users"
2. 找到用户 `yyc3-admin`，点击用户名
3. 点击 "Add user to groups"
4. 勾选用户组 `yyc3-admins`
5. 点击 "Add user to group"

**检查清单**：
- [ ] IAM管理员账户已添加到用户组

---

## 三、阿里云RAM权限配置

### 3.1 创建自定义策略

**步骤**：
1. 登录 [阿里云RAM控制台](https://ram.console.aliyun.com/)
2. 在左侧导航栏，点击 "权限管理" -> "权限策略"
3. 点击 "创建权限策略"
4. 选择配置模式："脚本配置"
5. 输入策略名称：`yyc3-full-access`
6. 输入备注：`YYC³餐饮平台 - 全局访问权限`
7. 输入策略内容：
   ```json
   {
     "Version": "1",
     "Statement": [
       {
         "Effect": "Allow",
         "Action": "*",
         "Resource": "*"
       }
     ]
   }
   ```
8. 点击 "确定"

**检查清单**：
- [ ] 自定义RAM策略已创建
- [ ] 策略名称：`yyc3-full-access`

---

### 3.2 创建用户组

**步骤**：
1. 在RAM控制台，点击 "人员管理" -> "用户组"
2. 点击 "创建用户组"
3. 输入用户组名称：`yyc3-admins`
4. 输入备注：`YYC³餐饮平台 - 管理员组`
5. 点击 "确定"

**检查清单**：
- [ ] RAM用户组已创建

---

### 3.3 添加权限到用户组

**步骤**：
1. 在RAM控制台，点击 "人员管理" -> "用户组"
2. 找到用户组 `yyc3-admins`，点击用户组名称
3. 点击 "添加权限"
4. 选择权限类型：`系统策略`
5. 搜索并添加策略：`yyc3-full-access`
6. 点击 "确定"

**检查清单**：
- [ ] 策略已添加到用户组

---

### 3.4 将RAM管理员账户添加到用户组

**步骤**：
1. 在RAM控制台，点击 "人员管理" -> "用户组"
2. 找到用户组 `yyc3-admins`，点击用户组名称
3. 点击 "添加组成员"
4. 搜索并勾选用户 `yyc3-admin`
5. 点击 "确定"

**检查清单**：
- [ ] RAM管理员账户已添加到用户组

---

## 四、腾讯云CAM权限配置

### 4.1 创建自定义策略

**步骤**：
1. 登录 [腾讯云CAM控制台](https://console.cloud.tencent.com/cam)
2. 在左侧导航栏，点击 "策略列表"
3. 点击 "新建自定义策略"
4. 选择创建方式："按策略语法创建"
5. 输入策略名称：`yyc3-full-access`
6. 输入备注：`YYC³餐饮平台 - 全局访问权限`
7. 选择模板："空白模板"
8. 输入策略内容：
   ```json
   {
     "version": "2.0",
     "statement": [
       {
         "effect": "allow",
         "action": "*",
         "resource": "*"
       }
     ]
   }
   ```
9. 点击 "创建策略"

**检查清单**：
- [ ] 自定义CAM策略已创建
- [ ] 策略名称：`yyc3-full-access`

---

### 4.2 创建用户组

**步骤**：
1. 在CAM控制台，点击 "用户组"
2. 点击 "新建用户组"
3. 输入用户组名称：`yyc3-admins`
4. 输入备注：`YYC³餐饮平台 - 管理员组`
5. 点击 "确定"

**检查清单**：
- [ ] CAM用户组已创建

---

### 4.3 添加权限到用户组

**步骤**：
1. 在CAM控制台，点击 "用户组"
2. 找到用户组 `yyc3-admins`，点击用户组名称
3. 点击 "权限管理" -> "关联策略"
4. 搜索并添加策略：`yyc3-full-access`
5. 点击 "确定"

**检查清单**：
- [ ] 策略已添加到用户组

---

### 4.4 将CAM管理员账户添加到用户组

**步骤**：
1. 在CAM控制台，点击 "用户组"
2. 找到用户组 `yyc3-admins`，点击用户组名称
3. 点击 "添加成员"
4. 搜索并勾选用户 `yyc3-admin`
5. 点击 "确定"

**检查清单**：
- [ ] CAM管理员账户已添加到用户组

---

## 五、验证与测试

### 5.1 验证AWS IAM

**命令**：
```bash
aws iam list-groups-for-user --user-name yyc3-admin
```

**预期输出**：
```json
{
  "Groups": [
    {
      "GroupId": "AGPAXXXXXXXXXXXXXXXX",
      "GroupName": "yyc3-admins",
      "Arn": "arn:aws:iam::123456789012:group/yyc3-admins",
      "CreateDate": "2026-01-04T00:00:00Z"
    }
  ]
}
```

---

### 5.2 验证阿里云RAM

**命令**：
```bash
aliyun ram ListGroupsForUser --UserName yyc3-admin
```

**预期输出**：
```json
{
  "Groups": [
    {
      "GroupId": "g-xxxxxxxxxxxxxxxx",
      "GroupName": "yyc3-admins",
      "Comments": "YYC³餐饮平台 - 管理员组",
      "CreateDate": "2026-01-04T00:00:00Z"
    }
  ]
}
```

---

### 5.3 验证腾讯云CAM

**命令**：
```bash
tccli cam ListGroupsForUser --Name yyc3-admin
```

**预期输出**：
```json
{
  "GroupInfo": [
    {
      "GroupId": 123,
      "GroupName": "yyc3-admins",
      "Remark": "YYC³餐饮平台 - 管理员组",
      "CreateTime": "2026-01-04T00:00:00Z"
    }
  ]
}
```

---

## 六、常见问题

### Q1: 为什么需要自定义策略而不是直接使用AdministratorAccess？

**A**：自定义策略可以更精细地控制权限。虽然这里使用了全局访问权限（等同于AdministratorAccess），但在未来可以根据实际需求缩小权限范围，遵循最小权限原则（Least Privilege）。

---

### Q2: 如何验证用户组中的用户具有正确的权限？

**A**：可以以该用户身份登录控制台，尝试创建一个测试资源（如S3 Bucket），验证是否有权限。

---

## 七、输出与交付物

| 交付物 | 内容 |
|-------|------|
| AWS IAM策略 | `yyc3-full-access` |
| AWS IAM用户组 | `yyc3-admins` |
| 阿里云RAM策略 | `yyc3-full-access` |
| 阿里云RAM用户组 | `yyc3-admins` |
| 腾讯云CAM策略 | `yyc3-full-access` |
| 腾讯云CAM用户组 | `yyc3-admins` |

---

**文档版本**: v1.0.0
**最后更新**: 2026-01-04
**维护人**: YYC³ Infrastructure Team
